// v2/core/i18n.js — minimal internationalization helper (migrated)
// Usage: import { t, setLocale } from '@v2/core/i18n';

import { AsyncStorage } from '../app/dependencies.js';

let currentLocale = 'en';
const fallbackLocale = 'en';

// Simple flat dictionaries.
const dictionaries = {
	en: {
		choose_role: 'Choose your role',
		role_business_desc: 'Manage services, bookings and clients.',
		enter_business: 'Enter Business',
		role_client_desc: 'Explore businesses and book services.',
		enter_client: 'Enter as Client',
		dashboard_welcome: 'Welcome',
		dashboard_overview: 'Overview',
		dashboard: 'Dashboard',
		quick_nav: 'Quick navigation',
		gps: 'GPS',
		gps_denied: 'GPS denied',
		gps_watch: 'Watch',
		gps_stop: 'Stop',
		gps_last_update: 'Last update',
		gps_stale: 'Stale location',
		open_settings: 'Open settings',
		gps_retrying: 'Retrying…',
		gps_errors: 'Errors',
		geofence_out: 'Outside area',
		geofence_in: 'On site',
		distance: 'Distance',
		map_title: 'Map',
		list_view: 'List',
		map_view: 'Map',
		filter_category_all: 'All',
		your_location_acquired: 'Location acquired',
		search_business_placeholder: 'Search businesses…',
		view_btn: 'View',
		radius_km: 'Radius (km)',
		geofence_set_here: 'Set geofence here',
		geofence_clear: 'Clear geofence',
		geofence_radius: 'Radius (m)',
		geofence_saved: 'Geofence saved',
		geofence_removed: 'Geofence removed',
		geofence_title: 'Geofence',
		geofence_none: 'No geofence set.',
		geofences: 'Geofences',
		add_geofence: 'Add geofence',
		activate: 'Activate',
		remove: 'Remove',
		active: 'Active',
		no_geofences: 'No geofences yet',
		geofence_events: 'Geofence events',
		enter_event: 'Enter',
		exit_event: 'Exit',
		location_missing: 'No location yet',
		geofence_error: 'Could not save geofence',
		location: 'Location',
		location_permission: 'Location permission',
		location_request: 'Request location',
		location_denied: 'Permission denied',
		location_error: 'Location error',
		location_lat: 'Lat',
		location_lng: 'Lng',
		location_refresh: 'Refresh',
		settings: 'Settings',
		settings_placeholder: 'More settings coming soon…',
		theme_mode: 'Theme',
		language: 'Language',
		toggle_theme: 'Toggle theme',
		theme_changed: 'Theme changed',
	settings_title: 'Settings',
	appearance: 'Appearance',
	role_title: 'Role',
	business_active: 'Business (active)',
	switch_business: 'Switch to Business',
	client_active: 'Client (active)',
	switch_client: 'Switch to Client',
	reset_role: 'Reset role (ask again)',
	business_info: 'Business info',
	client_mode: 'Client mode',
	client_mode_hint: 'Use Explore to find businesses and join waitlists or request times.',
	current_role: 'Current role',
	current_theme: 'Current',
	save: 'Save',
	saved: 'Saved',
		deleted: 'Deleted',
	business_info_updated: 'Business info updated.',
	role_changed: 'Role changed',
	now_in_business: 'Now you are in Business mode.',
	now_in_client: 'Now you are in Client mode.',
	switch_light: 'Switch to Light',
	switch_dark: 'Switch to Dark',
	locale: 'Language',
	language_changed: 'Language changed',
		kpi_bookings: 'Bookings',
		kpi_confirmed: 'Confirmed',
		kpi_pending: 'Pending',
		kpi_cancelled: 'Cancelled',
		kpi_active_services: 'Active services',
		kpi_requests: 'Requests (inbox)',
		kpi_conversions: 'Conversions',
		kpi_conversion_rate: 'Conversion %',
		kpi_fill_rate: 'Fill %',
		kpi_staff_util: 'Staff util %',
		data_export: 'Data export',
		notifications_center: 'Notifications',
		billing_invoices: 'Billing',
		calendar_sync: 'Calendar sync',
		accounting_integration: 'Accounting',
		webhooks: 'Webhooks',
		observability: 'Observability',
		feature_flags: 'Feature flags',
		migrations: 'Migrations',
		preferences: 'Preferences',
		messaging: 'Messaging',
		email_templates: 'Email templates',
		data_privacy: 'Data privacy / GDPR',
		sessions: 'Sessions',
		subscriptions: 'Subscriptions',
		referrals: 'Referrals',
		admin_panel: 'Admin panel',
		risk_monitoring: 'Risk / Fraud',
		support_tickets: 'Support tickets',
		intelligence: 'Intelligence',
		routes_optimization: 'Routes optimization',
		ai_services: 'AI services',
		sync_status: 'Sync status',
		analytics: 'Analytics',
		window: 'Window',
		aggregate: 'Aggregate',
		daily_trend: 'Daily Trend',
		upcoming_none: 'No upcoming bookings.',
		tips_business: 'Use Inbox to convert client requests into bookings, and keep Services updated.',
		tips_client: 'Use Pick time for a specific slot or join waitlist to be called sooner.',
		agenda: 'Agenda',
		services_title: 'Services',
		clients_title: 'Clients',
		inbox: 'Inbox',
		explore: 'Explore',
		my_bookings: 'My bookings',
		quick_actions: 'Quick actions',
		add_sample_service: 'Add sample service',
		create_booking_plus_60: 'Create booking +60min',
		confirm_first_pending: 'Confirm first pending',
		cancel_first_today: 'Cancel first today',
		upcoming: 'Upcoming',
		tips: 'Tips',
		today_label: 'Today',
		filters: 'Filters',
		search_client_placeholder: 'Search client…',
		no_bookings: 'No bookings.',
		confirm_btn: 'Confirm',
		cancel_btn: 'Cancel',
		new_booking: 'New booking',
		service: 'Service',
		day: 'Day',
		today: 'Today',
		tomorrow: 'Tomorrow',
		plus_7d: '+7d',
		available_slots: 'Available slots',
		selected_time: 'Selected time',
		client: 'Client',
		create_booking: 'Create booking',
		missing_fields: 'Missing fields',
		missing_booking_fields: 'Select service, time and phone.',
		overlap: 'Overlap',
		overlap_msg: 'There is another booking in that interval.',
		booking_created: 'Created',
		booking_created_msg: 'Booking created successfully.',
		error_in_past: 'Selected time already passed.',
		error_invalid_date: 'Invalid date.',
		error: 'Error',
		search_service_placeholder: 'Search service…',
		manage_offerings: 'Manage offerings',
		new_service: 'New service',
		save_service: 'Save service',
		no_services: 'No services',
		no_services_hint: 'Try another search or create a new one.',
		delete: 'Delete',
		please_fill_all: 'Please fill all fields',
		new_client: 'New client',
		save_client: 'Save client',
		no_clients: 'No clients.',
		bookings_count: 'Bookings',
		phone_required: 'Phone required',
		search: 'Search',
		search_placeholder: 'Name or phone…',
		join_waitlist: 'Join waitlist',
		pick_time: 'Pick time',
		view_services: 'View services',
		hide: 'Hide',
		requested: 'Requested',
		no_businesses: 'No businesses found.',
		no_services_listed: 'No services listed.',
		requested_time: 'Requested time',
		none: 'None.',
		queue: 'Queue',
		in_queue: 'in queue',
		remove: 'Remove',
		book_at_requested: 'Book at requested',
		book_next_slot: 'Book next slot',
		incoming_requests: 'Incoming requests',
		no_requests: 'No requests yet.',
		convert_requests_hint: 'Convert requests into bookings from',
		status: 'Status',
		requested_label: 'Requested'
	},
	es: {
		choose_role: 'Elige tu rol',
		role_business_desc: 'Gestiona servicios, reservas y clientes.',
		enter_business: 'Entrar como Negocio',
		role_client_desc: 'Explora negocios y reserva servicios.',
		enter_client: 'Entrar como Cliente',
		dashboard_welcome: 'Bienvenido',
		dashboard_overview: 'Resumen',
		quick_nav: 'Accesos rápidos',
		gps: 'GPS',
		gps_denied: 'GPS denegado',
		gps_watch: 'Vigilar',
		gps_stop: 'Parar',
		gps_last_update: 'Última actualización',
		gps_stale: 'Ubicación antigua',
		open_settings: 'Abrir ajustes',
		gps_retrying: 'Reintentando…',
		gps_errors: 'Errores',
		geofence_out: 'Fuera de zona',
		geofence_in: 'En sitio',
		distance: 'Distancia',
		map_title: 'Mapa',
		list_view: 'Lista',
		map_view: 'Mapa',
		filter_category_all: 'Todas',
		your_location_acquired: 'Ubicación obtenida',
		search_business_placeholder: 'Buscar negocios…',
		view_btn: 'Ver',
		radius_km: 'Radio (km)',
		geofence_set_here: 'Definir geocerca aquí',
		geofence_clear: 'Quitar geocerca',
		geofence_radius: 'Radio (m)',
		geofence_saved: 'Geocerca guardada',
		geofence_removed: 'Geocerca eliminada',
		geofence_title: 'Geocerca',
		geofence_none: 'Sin geocerca.',
		geofences: 'Geocercas',
		add_geofence: 'Añadir geocerca',
		activate: 'Activar',
		remove: 'Eliminar',
		active: 'Activa',
		no_geofences: 'Sin geocercas',
		geofence_events: 'Eventos geocerca',
		enter_event: 'Entrada',
		exit_event: 'Salida',
		location_missing: 'Sin ubicación aún',
		geofence_error: 'No se pudo guardar la geocerca',
		location: 'Ubicación',
		location_permission: 'Permiso de ubicación',
		location_request: 'Solicitar ubicación',
		location_denied: 'Permiso denegado',
		location_error: 'Error de ubicación',
		location_lat: 'Lat',
		location_lng: 'Lng',
		location_refresh: 'Actualizar',
		dashboard: 'Panel',
		agenda: 'Agenda',
		services_title: 'Servicios',
		clients_title: 'Clientes',
		inbox: 'Bandeja',
		explore: 'Explorar',
		my_bookings: 'Mis reservas',
		quick_actions: 'Acciones rápidas',
		add_sample_service: 'Añadir servicio demo',
		create_booking_plus_60: 'Crear reserva +60min',
		confirm_first_pending: 'Confirmar primera pendiente',
		cancel_first_today: 'Cancelar primera de hoy',
		upcoming: 'Próximas',
		tips: 'Consejos',
		today_label: 'Hoy',
		filters: 'Filtros',
		search_client_placeholder: 'Buscar cliente…',
		no_bookings: 'Sin reservas.',
		confirm_btn: 'Confirmar',
		cancel_btn: 'Cancelar',
		new_booking: 'Nueva reserva',
		service: 'Servicio',
		day: 'Día',
		today: 'Hoy',
		tomorrow: 'Mañana',
		plus_7d: '+7d',
		available_slots: 'Huecos disponibles',
		selected_time: 'Hora seleccionada',
		client: 'Cliente',
		create_booking: 'Crear reserva',
		missing_fields: 'Faltan datos',
		missing_booking_fields: 'Selecciona servicio, hora y teléfono.',
		overlap: 'Solapado',
		overlap_msg: 'Ya existe otra reserva en ese intervalo.',
		booking_created: 'Creada',
		booking_created_msg: 'Reserva creada correctamente.',
		error_in_past: 'La hora seleccionada ya pasó.',
		error_invalid_date: 'Fecha inválida.',
		error: 'Error',
		search_service_placeholder: 'Buscar servicio…',
		manage_offerings: 'Gestiona la oferta',
		new_service: 'Nuevo servicio',
		save_service: 'Guardar servicio',
		no_services: 'Sin servicios',
		no_services_hint: 'Prueba otra búsqueda o crea uno nuevo.',
		delete: 'Eliminar',
		please_fill_all: 'Rellena todos los campos',
		new_client: 'Nuevo cliente',
		save_client: 'Guardar cliente',
		no_clients: 'Sin clientes.',
		bookings_count: 'Reservas',
		phone_required: 'Teléfono requerido',
		search: 'Buscar',
		search_placeholder: 'Nombre o teléfono…',
		join_waitlist: 'Unirse a lista',
		pick_time: 'Elegir hora',
		view_services: 'Ver servicios',
		hide: 'Ocultar',
		requested: 'Solicitada',
		no_businesses: 'No se encontraron negocios.',
		no_services_listed: 'Sin servicios listados.',
		requested_time: 'Hora solicitada',
		none: 'Ninguno.',
		queue: 'Cola',
		in_queue: 'en cola',
		remove: 'Eliminar',
		book_at_requested: 'Reservar en solicitada',
		book_next_slot: 'Reservar próximo hueco',
		incoming_requests: 'Solicitudes entrantes',
		no_requests: 'Sin solicitudes aún.',
		convert_requests_hint: 'Convierte solicitudes en reservas de',
		status: 'Estado',
		requested_label: 'Solicitada',
		settings: 'Ajustes',
		settings_title: 'Ajustes',
		settings_placeholder: 'Más ajustes pronto…',
		theme_mode: 'Tema',
		language: 'Idioma',
		toggle_theme: 'Cambiar tema',
		theme_changed: 'Tema cambiado',
		appearance: 'Apariencia',
		role_title: 'Rol',
		business_active: 'Negocio (activo)',
		switch_business: 'Cambiar a Negocio',
		client_active: 'Cliente (activo)',
		switch_client: 'Cambiar a Cliente',
		reset_role: 'Reiniciar rol (preguntar de nuevo)',
		business_info: 'Info del negocio',
		client_mode: 'Modo cliente',
		client_mode_hint: 'Usa Explorar para encontrar negocios y unirte a listas de espera o solicitar horarios.',
		current_role: 'Rol actual',
		current_theme: 'Actual',
		save: 'Guardar',
		saved: 'Guardado',
		deleted: 'Eliminado',
		business_info_updated: 'Información del negocio actualizada.',
		role_changed: 'Rol cambiado',
		now_in_business: 'Ahora estás en modo Negocio.',
		now_in_client: 'Ahora estás en modo Cliente.',
		switch_light: 'Cambiar a Claro',
		switch_dark: 'Cambiar a Oscuro',
		locale: 'Idioma',
		language_changed: 'Idioma cambiado',
		kpi_bookings: 'Reservas',
		kpi_confirmed: 'Confirmadas',
		kpi_pending: 'Pendientes',
		kpi_cancelled: 'Canceladas',
		kpi_active_services: 'Servicios activos',
		kpi_requests: 'Solicitudes (inbox)',
		kpi_conversions: 'Conversiones',
		kpi_conversion_rate: '% Conversión',
		kpi_fill_rate: '% Ocupación',
		kpi_staff_util: '% Utilización staff',
		data_export: 'Exportación de datos',
		notifications_center: 'Notificaciones',
		billing_invoices: 'Facturación',
		calendar_sync: 'Sincronización calendario',
		accounting_integration: 'Contabilidad',
		webhooks: 'Webhooks',
		observability: 'Observabilidad',
		feature_flags: 'Feature flags',
		migrations: 'Migraciones',
		preferences: 'Preferencias',
		messaging: 'Mensajería',
		email_templates: 'Plantillas email',
		data_privacy: 'Privacidad / RGPD',
		sessions: 'Sesiones',
		subscriptions: 'Suscripciones',
		referrals: 'Referidos',
		admin_panel: 'Panel admin',
		risk_monitoring: 'Riesgo / Fraude',
		support_tickets: 'Tickets soporte',
		intelligence: 'Inteligencia',
		routes_optimization: 'Optimización rutas',
		ai_services: 'Servicios IA',
		sync_status: 'Estado sync',
		analytics: 'Analítica',
		window: 'Ventana',
		aggregate: 'Agregado',
		daily_trend: 'Tendencia diaria',
		upcoming_none: 'Sin próximas reservas.',
		tips_business: 'Usa Inbox para convertir solicitudes en reservas y mantén Servicios actualizado.',
		tips_client: 'Usa Pick time para un horario específico o únete a la lista de espera.'
	}
};

const LOCALE_KEY = 'nx_locale';

export async function setLocale(loc) {
	if (dictionaries[loc]) {
		currentLocale = loc;
		try { await AsyncStorage.setItem(LOCALE_KEY, loc); } catch {}
	}
}

export async function initLocale() {
	try {
		const saved = await AsyncStorage.getItem(LOCALE_KEY);
		if (saved && dictionaries[saved]) currentLocale = saved;
	} catch {}
	return currentLocale;
}

export function getLocale() { return currentLocale; }

export function t(key) {
	const dict = dictionaries[currentLocale] || dictionaries[fallbackLocale];
	return dict[key] || key;
}

export function availableLocales() { return Object.keys(dictionaries); }

// compatibility hook (legacy screens expected useI18n())
export function useI18n() {
	return { locale: getLocale(), setLocale };
}
